<!--
本文件由智谱 AI 自动翻译生成
原文件: evaluation.md
翻译时间: 2025-12-12 16:11:57
翻译模型: glm-4-flash
原文大小: 21,659 字符
-->

# MCP 服务器评估指南

## 概述

本文档提供了创建全面评估 MCP 服务器的指南。评估测试 LLM 是否能够有效地使用您的 MCP 服务器，仅使用提供的工具来回答现实、复杂的问题。

---

## 快速参考

### 评估要求
- 创建 10 个可读性问题
- 问题必须是只读的、独立的、非破坏性的
- 每个问题都需要多次工具调用（可能多达数十次）
- 答案必须是单一、可验证的值
- 答案必须是稳定的（不会随时间改变）

### 输出格式
```xml
<evaluation>
   <qa_pair>
      <question>你的问题在这里</question>
      <answer>单一可验证的答案</answer>
   </qa_pair>
</evaluation>
```

---

## 评估目的

MCP 服务器质量的衡量标准不是服务器实现工具的好坏或全面性，而是这些实现（输入/输出模式、文档字符串/描述、功能）如何使没有其他上下文且仅访问 MCP 服务器而没有其他资源的 LLM 能够回答现实和困难的问题。

## 评估概述

创建 10 个需要仅进行只读、独立、非破坏性和幂等操作来回答的问题。每个问题应该是：
- 现实的
- 清晰简洁的
- 不含糊的
- 复杂的，可能需要数十次工具调用或步骤
- 可以用一个单一、可验证的值来回答，这个值你事先已经确定

## 问题指南

### 核心要求

1. **问题必须是独立的**
   - 每个问题不应依赖于其他任何问题的答案
   - 不应假设处理其他问题时的先前写操作

2. **问题必须仅使用非破坏性和幂等的工具**
   - 不应指示或要求修改状态以到达正确的答案

3. **问题必须是现实的、清晰的、简洁的和复杂的**
   - 必须要求另一个 LLM 使用多个（可能多达数十个）工具或步骤来回答

### 复杂性和深度

4. **问题必须需要深入探索**
   - 考虑多跳问题，需要多个子问题和顺序工具调用
   - 每个步骤都应从先前问题中找到的信息受益

5. **问题可能需要大量分页**
   - 可能需要浏览多个结果页面
   - 可能需要查询旧数据（1-2 年前的数据）以找到特定信息
   - 问题必须是困难的

6. **问题必须需要深入理解**
   - 而不是表面知识
   - 可能将复杂思想作为需要证据的真/假问题
   - 可能使用多选题格式，其中 LLM 必须搜索不同的假设

7. **问题不能通过简单的关键字搜索来解决**
   - 不要包含来自目标内容的特定关键字
   - 使用同义词、相关概念或释义
   - 需要进行多次搜索，分析多个相关项目，提取上下文，然后得出答案

### 工具测试

8. **问题应该测试工具返回值**
   - 可能会引发返回大型 JSON 对象或列表的工具，使 LLM 应接不暇
   - 应要求理解多种数据模态：
     - ID 和名称
     - 时间戳和日期时间（月份、天数、年份、秒）
     - 文件 ID、名称、扩展名和 MIME 类型
     - URL、GIDs 等。
   - 应测试工具返回所有有用数据形式的能力

9. **问题应该主要反映真实的人类用例**
   - 人类由 LLM 协助进行的信息检索任务

10. **问题可能需要数十次工具调用**
    - 这挑战了具有有限上下文的 LLM
    - 鼓励 MCP 服务器工具减少返回的信息

11. **包含模糊性问题**
    - 可能是模糊的或需要关于调用哪些工具的困难决定
    - 迫使 LLM 可能会犯错误或误解
    - 确保即使在模糊的情况下，仍然有一个可验证的答案

### 稳定性

12. **问题必须设计得使答案不会改变**
    - 不要问依赖于“当前状态”的问题，因为它是动态的
    - 例如，不要计算：
      - 帖子的反应数量
      - 线程的回复数量
      - 通道中的成员数量

13. **不要让 MCP 服务器限制你创建的问题类型**
    - 创建具有挑战性和复杂性的问题
    - 一些可能无法使用可用的 MCP 服务器工具解决
    - 问题可能需要特定的输出格式（日期时间与纪元时间、JSON 与 MARKDOWN）
    - 问题可能需要数十次工具调用才能完成

## 答案指南

### 验证

1. **答案必须可以通过直接字符串比较来验证**
   - 如果答案可以用许多格式重写，请在问题中清楚地指定输出格式
   - 例如：“使用 YYYY/MM/DD。”，“回答 True 或 False。”，“回答 A、B、C 或 D，不要回答其他内容。”
   - 答案应是一个单一的、可验证的值，例如：
     - 用户 ID、用户名、显示名、名、姓
     - 通道 ID、通道名
     - 消息 ID、字符串
     - URL、标题
     - 数量
     - 时间戳、日期时间
     - 布尔值（用于真/假问题）
     - 电子邮件地址、电话号码
     - 文件 ID、文件名、文件扩展名
     - 多选题答案
   - 答案不得需要特殊的格式或复杂的、结构化的输出
   - 答案将通过直接字符串比较进行验证

### 可读性

2. **答案应一般优先考虑人类可读的格式**
   - 例如：名称、名、姓、日期时间、文件名、消息字符串、URL、是/否、真/假、a/b/c/d
   - 而不是不透明的 ID（尽管 ID 是可接受的）
   - 大多数答案应该是人类可读的

### 稳定性

3. **答案必须是稳定的/静止的**
   - 查看旧内容（例如，结束的对话、已启动的项目、已回答的问题）
   - 基于始终返回相同答案的“关闭”概念创建问题
   - 问题可以要求考虑固定的时间窗口以防止非静止答案
   - 依赖于不太可能改变的环境
   - 例如：如果查找论文名称，应足够具体，以便答案不会与后来发表的论文混淆

### 多样性

4. **答案必须是多样化的**
   - 答案应是一个单一的、可验证的值，以多种模态和格式
   - 用户概念：用户 ID、用户名、显示名、名、姓、电子邮件地址、电话号码
   - 通道概念：通道 ID、通道名、通道主题
   - 消息概念：消息 ID、消息字符串、时间戳、月份、天数、年份

5. **答案不得是复杂结构**
   - 不是一个值列表
   - 不是一个复杂对象
   - 不是一个 ID 或字符串列表
   - 不是一个自然语言文本
   - 除非答案可以简单地使用直接字符串比较来验证
   - 并且可以现实地复制
   - 应该不太可能 LLM 会以任何其他顺序或格式返回相同的列表

## 评估流程

### 第 1 步：文档检查

阅读目标 API 的文档以了解：
- 可用端点和功能
- 如果存在歧义，从网络上获取更多信息
- 尽可能并行化此步骤
- 确保每个子代理仅检查文件系统或网络上的文档

### 第 2 步：工具检查

列出 MCP 服务器中可用的工具：
- 直接检查 MCP 服务器
- 理解输入/输出模式、文档字符串和描述
- 在此阶段不要调用工具本身

### 第 3 步：理解开发

重复步骤 1 和 2，直到你有一个很好的理解：
- 迭代多次
- 考虑你想要创建的任务类型
- 精炼你的理解
- 在任何阶段都不应阅读 MCP 服务器实现本身的代码
- 使用你的直觉和理解来创建合理、现实但极具挑战性的任务

### 第 4 步：只读内容检查

在了解 API 和工具之后，使用 MCP 服务器工具：
- 仅使用只读和非破坏性操作检查内容
- 目标：确定创建现实问题的特定内容（例如，用户、通道、消息、项目、任务）
- 不应调用任何修改状态的工具
- 不会阅读 MCP 服务器实现本身的代码
- 与单个子代理并行化此步骤，进行独立探索
- 确保每个子代理仅执行只读、非破坏性和幂等的操作
- 小心：某些工具可能会返回大量数据，这会导致你耗尽上下文
- 进行增量、小型和有针对性的工具调用以进行探索
- 在所有工具调用请求中，使用 `limit` 参数限制结果（<10）
- 使用分页

### 第 5 步：任务生成

在检查内容后，创建 10 个可读性问题：
- LLM 应该能够使用 MCP 服务器来回答这些问题
- 遵循上述所有问题和答案指南

## 输出格式

每个 QA 对由一个问题和一个答案组成。输出应是一个具有以下结构的 XML 文件：

```xml
<evaluation>
   <qa_pair>
      <question>在 2024 年第二季度创建的、完成任务数量最多的项目中，项目名称是什么？</question>
      <answer>网站重设计</answer>
   </qa_pair>
   <qa_pair>
      <question>搜索 2024 年 3 月关闭的标记为“错误”的问题。哪个用户关闭了最多的问题？请提供他们的用户名。</question>
      <answer>sarah_dev</answer>
   </qa_pair>
   <qa_pair>
      <question>查找修改了 /api 目录中的文件并在 2024 年 1 月 1 日至 1 月 31 日之间合并的拉取请求。有多少不同的贡献者参与了这些 PR？</question>
      <answer>7</answer>
   </qa_pair>
   <qa_pair>
      <question>查找在 2023 年之前创建的、星级最高的存储库。存储库名称是什么？</question>
      <answer>data-pipeline</answer>
   </qa_pair>
</evaluation>
```

## 评估示例

### 好的问题

**示例 1：需要深度探索的多跳问题（GitHub MCP）**
```xml
<qa_pair>
   <question>找到在 2023 年第三季度存档且之前是该组织中最受分叉的项目存储库。该存储库中使用了哪种主要编程语言？</question>
   <answer>Python</answer>
</qa_pair>
```

这个问题是好的，因为：
- 需要进行多次搜索以找到存档的存储库
- 需要确定哪些在存档之前有最多的分叉
- 需要检查存储库详细信息以确定语言
- 答案是一个简单、可验证的值
- 基于历史（关闭）数据，不会改变

**示例 2：需要理解上下文而不进行关键字匹配（项目管理 MCP）**
```xml
<qa_pair>
   <question>定位在 2023 年年底完成的、专注于改进客户入职的倡议。项目负责人在完成后创建了一份回顾文档。当时负责人的职位头衔是什么？</question>
   <answer>产品经理</answer>
</qa_pair>
```

这个问题是好的，因为：
- 不使用特定的项目名称（“专注于改进客户入职的倡议”）
- 需要找到特定时间范围内的已完成的项目
- 需要确定项目负责人及其职位
- 需要理解回顾文档中的上下文
- 答案是可读的且稳定的
- 基于已完成的工作（不会改变）

**示例 3：需要多个步骤的复杂聚合（问题跟踪器 MCP）**
```xml
<qa_pair>
   <question>在 2024 年 1 月报告的所有标记为“关键优先级”的 bug 中，哪个分配者解决了其分配的 bug 的百分比最高？请提供分配者的用户名。</question>
   <answer>alex_eng</answer>
</qa_pair>
```

这个问题是好的，因为：
- 需要根据日期、优先级和状态过滤 bug
- 需要按分配者分组并计算解决率
- 需要理解时间戳以确定 48 小时窗口
- 测试分页（可能需要处理许多 bug）
- 答案是一个单一的用户名
- 基于特定时间段的和历史数据

**示例 4：需要跨多个数据类型进行综合（CRM MCP）**
```xml
<qa_pair>
   <question>查找在 2023 年第四季度从入门级升级到企业计划的账户，并且年度合同价值最高。该账户运营在哪个行业？</question>
   <answer>医疗保健</answer>
</qa_pair>
```

这个问题是好的，因为：
- 需要理解订阅层级的更改
- 需要确定特定时间范围内的升级事件
- 需要比较合同价值
- 必须访问账户行业信息
- 答案简单且可验证
- 基于已完成的历史交易

### 差的问题

**示例 1：答案随时间改变**
```xml
<qa_pair>
   <question>目前分配给工程团队的开放问题有多少？</question>
   <answer>47</answer>
</qa_pair>
```

这个问题是差的，因为：
- 答案会随着问题的创建、关闭或重新分配而改变
- 不是基于稳定/静止的数据
- 依赖于“当前状态”，这是动态的

**示例 2：太简单，可以进行关键字搜索**
```xml
<qa_pair>
   <question>找到标题为“添加身份验证功能”的拉取请求，并告诉我谁创建了它。</question>
   <answer>developer123</answer>
</qa_pair>
```

这个问题是差的，因为：
- 可以通过简单的关键字搜索精确标题来解决
- 不需要深度探索或理解
- 不需要综合或分析

**示例 3：答案格式模糊**
```xml
<qa_pair>
   <question>列出所有以 Python 作为主要语言的存储库。</question>
   <answer>repo1, repo2, repo3, data-pipeline, ml-tools</answer>
</qa_pair>
```

这个问题是差的，因为：
- 答案是一个列表，可以以任何顺序返回
- 难以通过直接字符串比较进行验证
- LLM 可能以不同的