<!--
本文件由智谱 AI 自动翻译生成
原文件: SKILL.md
翻译时间: 2025-12-12 16:12:44
翻译模型: glm-4-flash
原文大小: 2,947 字符
-->

---
name: test-fixing
description: 运行测试并使用智能错误分组系统性地修复所有失败的测试。当用户请求修复失败的测试、提及测试失败、运行测试套件且发生失败或请求使测试通过时使用。
---

# 测试修复

使用智能分组策略系统性地识别和修复所有失败的测试。

## 何时使用

- 明确请求修复测试（“修复这些测试”，“使测试通过”）
- 报告测试失败（“测试失败”，“测试套件损坏”）
- 完成实现并希望测试通过
- 提及由于测试导致的 CI/CD 失败

## 系统性方法

### 1. 初始测试运行

运行 `make test` 以识别所有失败的测试。

分析输出以：
- 失败总数
- 错误类型和模式
- 受影响的模块/文件

### 2. 智能错误分组

通过以下方式按相似性分组类似失败：
- **错误类型**：ImportError、AttributeError、AssertionError 等
- **模块/文件**：同一文件导致多个测试失败
- **根本原因**：缺少依赖项、API 变更、重构影响

按以下顺序优先级分组：
- 受影响测试的数量（影响最大者优先）
- 依赖顺序（先修复基础设施再修复功能）

### 3. 系统性修复过程

对于每个组（从影响最大的开始）：

1. **识别根本原因**
   - 阅读相关代码
   - 使用 `git diff` 检查最近的变化
   - 理解错误模式

2. **实施修复**
   - 使用编辑工具进行代码更改
   - 遵循项目约定（见 CLAUDE.md）
   - 进行最小、集中的更改

3. **验证修复**
   - 运行此组的相关测试子集
   - 使用 pytest 标记或文件模式：
     ```bash
     uv run pytest tests/path/to/test_file.py -v
     uv run pytest -k "pattern" -v
     ```
   - 确保组通过后再进行下一步

4. **移动到下一组**

### 4. 修复顺序策略

**先基础设施：**
- 导入错误
- 缺少依赖项
- 配置问题

**然后 API 变更：**
- 函数签名更改
- 模块重组
- 重命名的变量/函数

**最后，逻辑问题：**
- 断言失败
- 业务逻辑错误
- 边界情况处理

### 5. 最终验证

修复所有组后：
- 运行完整的测试套件：`make test`
- 验证没有回归
- 检查测试覆盖率保持完整

## 最佳实践

- 一次修复一个组
- 每次修复后运行集中测试
- 使用 `git diff` 理解最近的变化
- 寻找失败的模式
- 在当前组通过之前不要移动到下一组
- 保持更改最小和集中

## 示例工作流程

用户： “我的重构后测试失败了”

1. 运行 `make test` → 识别出 15 个失败
2. 分组错误：
   - 8 个 ImportError（模块重命名）
   - 5 个 AttributeError（函数签名更改）
   - 2 个 AssertionError（逻辑错误）
3. 首先修复 ImportError → 运行子集 → 验证
4. 修复 AttributeError → 运行子集 → 验证
5. 修复 AssertionError → 运行子集 → 验证
6. 运行完整套件 → 所有通过 ✓